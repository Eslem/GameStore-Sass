<!DOCTYPE html>
<html>
    <head>
        <title>Categorias</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link href="css/categorias.css" rel="stylesheet" type="text/css"/>

        <link href='http://fonts.googleapis.com/css?family=Francois+One' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>

        <script src="libs/jquery/jquery.js" type="text/javascript"></script>
        <link href="libs/fontawesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
        <script src="js/animacion.js" type="text/javascript"></script>
        <script>
            var categories;
            var exist = false;

            function getCategories(callback) {
                $.ajax({
                    url: 'php/controller/categoriaController.php',
                    type: 'POST',
                    data: {
                        query: 'select'
                    }
                }).success(function(result) {
                    categories = JSON.parse(result);
                    callback(categories);
                }).error(function(errorHTML) {
                    $('#log').html(errorHTML);
                });
            }

            function getProductsByCategory(category, callback) {
                $.ajax({
                    url: 'php/controller/productoController.php',
                    type: 'POST',
                    data: {
                        query: 'selectJoin',
                        otherTable: 'producto_categorias',
                        field: 'id',
                        otherField: 'idProducto',
                        condition: 'idCategoria = ' + category
                    }
                }).success(function(result) {
                    callback(result);
                }).error(function(errorHTML) {
                    $('#log').html(errorHTML);
                });
            }

            $('document').ready(function() {
                getCategories(function(result) {
                    for (var i in result) {
                        $('ul#categories').append('<li style="color: white;" data-id="' + result[i].id + '">'
                                + result[i].nombre + '</li>');
                        $('ul#categories li:last-child').click(function(self) {
                            getProductsByCategory($(self.target).attr('data-id'), function(result) {
                                if (result !== '' && result !== null) {
                                    result = JSON.parse(result);
                                    $('#divGames').html('');
                                    for (var i in result) {
                                        $('#divGames').append('<li style="color: white;">' + result[i].nombre
                                                + '<img src="images/games/' + result[i].id
                                                + '.jpg"></img></li>');
                                    }
                                } else {
                                    $('#divGames').html('');
                                }

                            });
                        });
                    }
                });
            });
        </script>
    </head>
    <body>
        <div class="navbar invisible">

            <img src="images/logo1.png" alt="logo" class="logo">

            <ul>
                <li><a href="#">Opt1</a></li>
                <li class="active"><a href="#">Opt2</a></li>
                <li><a href="#">Opt3</a></li>  
                <li class="slide-nav"><i class="fa fa-bars"></i></li>
            </ul>
            <form class="navbar-form navbar-right">
                <input type="text" class="form-slideLeft" placeholder="Login">
                <input type="text" class="form-slideLeft" placeholder="Password">
                <div class="hexagon navbar-right show-animate inactive">
                    <i class="fa fa-sign-in"></i>
                </div>

            </form>
        </div>
        <div id="divCategories">
            <ul id="categories"></ul>
            <div id="divGames">

            </div>

            <div id="log"></div>

            <div class="gallery2">
                <div class="imagenes">
                    <div class="game">

                        <img src="images/games/5.jpg" alt>


                        <div class="info">
                            <div>The Witcher 3</div><!--<div class="precio">60.00â‚¬</div>-->
                        </div>

                    </div>


                </div>                
            </div>
        </div>
    </body>
</html>
