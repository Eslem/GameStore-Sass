<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <script src="libs/jquery/jquery.js" type="text/javascript"></script>
        <script>
            var categories;

            function getCategories(callback) {
                $.ajax({
                    url: 'php/controller/categoriaController.php',
                    type: 'POST',
                    data: {
                        query: 'select'
                    }
                }).success(function(result) {
                    categories = JSON.parse(result);
                    callback(categories);
                }).error(function(errorHTML) {
                    $('#log').html(errorHTML);                    
                });
            }

            function getProductsByCategory(category, callback) {
                $.ajax({
                    url: 'php/controller/productoController.php',
                    type: 'POST',
                    data: {
                        query: 'selectJoin',
                        otherTable: 'producto_categorias',
                        field: 'id',
                        otherField: 'idProducto',
                        condition: 'idCategoria = ' + category
                    }
                }).success(function(result) {
                    callback(JSON.parse(result));
                }).error(function(errorHTML) {
                    $('#log').html(errorHTML);                    
                });
            }

            $('document').ready(function() {
                getCategories(function(result) {
                    for (var i in result) {
                        $('ul#categories').append('<li data-id="' + result[i].id + '">'
                                + result[i].nombre + '</li>');
                        $('ul#categories li:last-child').click(function(self) {
                            getProductsByCategory($(self.target).attr('data-id'), function(result) {
                                $('#divGames').html('');
                                for (var i in result) {
                                    $('#divGames').append('<li>' + result[i].nombre + '</li>');
                                }
                            });
                        });
                    }
                });
            });
        </script>
    </head>
    <body>
        <div id="divCategories">
            <ul id="categories"></ul>
            <div id="divGames">

            </div>

            <div id="log"></div>
        </div>
    </body>
</html>
